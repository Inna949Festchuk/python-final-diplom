## Юзер флоу с ссылками на эндпоинты:
*Ниже представлен уточненный юзер флоу с привязкой к эндпоинтам. Дданный юзер флоу охватывает полное взаимодействие пользователя с интернет-магазином, включая регистрацию, авторизацию, управление контактами, работу с заказами и управление магазинами, а также события, которые инициируют отправку уведомлений по электронной почте, улучшая пользовательский опыт и обеспечивая ясность в коммуникации.*

---

### 1. **Регистрация пользователя**
- Эндпоинт: **POST `/user/register`**
  - Новый пользователь регистрируется, предоставляя email, пароль и дополнительные данные (например, для магазинов — `company` и `position`).
- Событие: При создании нового пользователя отправляется e-mail с токеном подтверждения для активации учетной записи.
- Подтверждение email:
  - Эндпоинт: **POST `/user/register/confirm`**
  - Пользователь подтверждает свою почту, чтобы активировать учетную запись (`is_active`).

---

### 2. **Авторизация**
- Эндпоинт: **POST `/user/login`**
  - Пользователь вводит логин (email) и пароль для входа в систему. После успешного входа система проверяет активность учетной записи (`is_active`).

---

### 3. **Просмотр данных пользователя**
- Эндпоинт: **GET `/user/details`**
  - Зарегистрированный пользователь получает информацию о своем профиле.

---

### 4. **Управление контактами пользователя**
- Эндпоинт: **POST/GET/PUT/DELETE `/user/contact`**
  - Пользователь может добавлять, изменять или удалять контактную информацию (например, адрес и телефон), используемую для выполнения заказов.

---

### 5. **Работа покупателей**

#### 5.1. **Просмотр магазинов**
- Эндпоинт: **GET `/shops`**
  - Покупатель получает список активных магазинов, готовых к приему заказов.

#### 5.2. **Просмотр категорий товаров**
- Эндпоинт: **GET `/categories`**
  - Пользователь видит список категорий товаров, доступных для покупки.

#### 5.3. **Просмотр товаров магазина**
- Эндпоинт: **GET `/products`**
  - Покупатель видит доступные товары из каталога магазина, включая их характеристики и наличие.

#### 5.4. **Добавление товаров в корзину**
- Эндпоинт: **POST/GET/PUT/DELETE `/basket`**
  - Пользователь может добавлять товары в корзину, редактировать их количество или удалять их. На этом этапе создается заказ с полем `state="basket"`.

#### 5.5. **Оформление заказа**
- Эндпоинт: **POST `/order`**
  - Покупатель отправляет форму с контактными данными. Заказ меняет статус на `state="new"` и становится доступен для обработки магазином.

---

### 6. **Работа с заказами**

#### 6.1. **Просмотр своих заказов (покупатель)**
- Эндпоинт: **GET `/order`**
  - Покупатель видит список своих заказов, их статусы (`new`, `confirmed`, `sent`, `delivered`, `canceled`) и детали.

#### 6.2. **Получение заказов (магазин)**
- Эндпоинт: **GET `/partner/orders`**
  - Магазин получает список новых заказов, поступивших от покупателей, для обработки.

#### 6.3. **Обновление состояния заказа**
- Эндпоинт: **PUT `/partner/orders`**
  - Магазин меняет статус заказа на значения `"confirmed"`, `"assembled"`, `"sent"`, `"delivered"` или `"canceled"` в соответствии с этапами его обработки.
- Событие: При изменении состояния заказа отправляется e-mail пользователю с уведомлением о статусе заказа. 

---

### 7. **Управление магазином (для владельцев магазинов)**

#### 7.1. **Обновление товаров и данных магазина**
- Эндпоинт: **POST `/partner/update`**
  - Магазин добавляет или обновляет информацию о своих товарах, ценах и наличии.

#### 7.2. **Изменение статуса магазина**
- Эндпоинт: **PUT `/partner/state`**
  - Владелец магазина может включать или отключать свой магазин, чтобы управлять возможностью принимать новые заказы (`state=True/False`).

---

### 8. **Сброс пароля**
- Эндпоинты:
  - **POST `/user/password_reset`** — для запроса сброса пароля.
  - Событие: При создании токена сброса пароля отправляется e-mail пользователю с токеном для сброса пароля.
  - **POST `/user/password_reset/confirm`** — для подтверждения сброса и установки нового пароля.





Юзер флоу описывает взаимодействие пользователя с системой интернет-магазина, построенного на основе моделей выше. Вот шаги:

### 1. **Регистрация пользователя**
   - Пользователь может зарегистрироваться как:
     - **Покупатель (buyer)** — роль по умолчанию.
     - **Магазин (shop)** — с указанием данных о компании.
   - Для регистрации пользователь предоставляет обязательные данные: 
     - `email` (уникальный идентификатор),
     - пароль,
     - опционально `company` и `position` (для магазинов).
   - После регистрации пользователь получает подтверждение email через модель `ConfirmEmailToken`. Этот шаг необходим для активации аккаунта (`is_active`).

### 2. **Авторизация**
   - Пользователь входит в систему, используя свой email и пароль.
   - После входа система проверяет `is_active`, чтобы убедиться, что email был подтверждён.
   - На основе значения поля `type` (`shop` или `buyer`) система предоставляет соответствующий функционал:
     - Покупатель видит список магазинов и продуктов.
     - Магазин может управлять своими товарами и наличием.

### 3. **Работа покупателей:**
   
#### 3.1. **Просмотр магазинов и категорий**
   - Пользователь видит магазины, которые активно принимают заказы (`Shop.state = True`).
   - Для перечисленных магазинов отображаются категории (`Category`) и соответствующие продукты (`Product`).

#### 3.2. **Добавление товаров в корзину (заказ со статусом `basket`)**
   - Покупатель добавляет товар (используя `ProductInfo`) в корзину. На этом этапе создается объект `Order`:
     - Поле `state` равно `"basket"`.
     - Модель `OrderItem` связывает заказ с конкретными товарами (`ProductInfo`) и количеством.
   - Покупатель может управлять своим заказом (изменять количество, удалять позиции) до его оформления.

#### 3.3. **Оформление заказа**
   - Пользователь заполняет контактные данные через модель `Contact` (например, город, улица, телефон).
   - При отправке заказа поле `state` для `Order` меняется на `"new"`. Этот статус означает, что заказ был создан и ожидает подтверждения магазина.

### 4. **Работа магазина**

#### 4.1. **Получение и подтверждение заказа**
   - Магазин получает список заказов, отправленных покупателями (`Order` с `state="new"`) для обработки.
   - После согласования деталей (например, проверки ассортимента, оплаты) магазин устанавливает статус заказа:
     - `"confirmed"` — заказ подтвержден и передан на сборку.
     - `"canceled"` — заказ отменен.

#### 4.2. **Сборка и отправка заказа**
   - Когда заказ готов, поле `state` меняется на:
     - `"assembled"` — заказ собран.
     - `"sent"` — заказ передан службе доставки.

#### 4.3. **Обработка доставки**
   - После доставки покупателю магазин устанавливает статус:
     - `"delivered"` — заказ успешно доставлен.

### 5. **Отслеживание статусов заказа покупателем**
   - Покупатель может в любое время увидеть свои заказы (связь `Order.user`), а также их статусы (`state`), например:
     - Новый,
     - Подтвержден,
     - Отправлен,
     - Доставлен,
     - Отменен.

### 6. **Управление магазином**
   - Владельцы магазинов могут:
     - Изменять товары и их характеристики (через модели `Product`, `ProductInfo`, `ProductParameter`).
     - Добавлять новые товары в каталог.
     - Управлять статусом магазина (`Shop.state`):
       - Включать/отключать возможность получения заказов.

### 7. **Уведомления**
   - После ключевых переходов между статусами (`state`), пользователи получают уведомления:
     - Покупатель получает уведомление об изменении статуса заказа.
     - Магазин уведомляется о новом заказе.

### Пример:
1. Покупатель зарегистрировался и подтвердил email.
2. Зашел в магазин, выбрал товар и добавил в корзину (`basket`).
3. Заполнил контактные данные и оформил заказ (`new`).
4. Магазин подтвердил заказ (`confirmed`), собрал его (`assembled`), отправил (`sent`) и успешно доставил (`delivered`).

Этот юзер флоу позволяет четко организовать взаимодействие пользователей, магазинов и системы для управления электронной коммерцией.





В классе `Shop` поле `state` используется для обозначения статуса получения заказов, что позволяет управлять возможностью или ограничениями на выполнение заказов из данного магазина. 

### Описание поля `state`

- **Имя поля**: `state`
- **Тип данных**: `BooleanField`
- **Значение по умолчанию**: `True` (магазин по умолчанию принимает заказы).

### Возможные значения:

1. **True**:
   - Магазин активно принимает заказы. Это означает, что пользователи могут оформлять покупки, и заказы будут обрабатываться.
  
2. **False**:
   - Магазин временно не принимает заказы. Это может быть использовано в ситуациях, когда магазин закрыт, ведутся работы или другой обстоятельств, из-за которого не могут приниматься заказы.

### Применение поля `state`

Поле `state` может быть полезно для реализации различных бизнес-процессов:

- **Управление доступностью**: Если магазин временно закрыт (например, на ремонт или на время распродажи с изменением ассортимента), это поле может быть установлено в `False`, и все попытки оформить заказ будут отклонены.
- **Уведомления**: Система может уведомлять пользователей о том, что магазин не принимает заказы в данный момент.
- **Логика обработки**: В зависимости от состояния этого поля, можно динамически изменять доступность кнопок и форм для оформления заказа на фронтенде.

Таким образом, поле `state` в модели `Shop` играет важную роль в управлении состоянием магазина и оптимизации взаимодействия клиентов с ним.